# 如何使用定理辅助证明器*Lean*形式化泵引理的证明过程

本文实现代码：[Computability](https://github.com/JohnsonLee-debug/Computability)

## 背景介绍

本学期的计算理论基础是一门非常有趣的课，课程中涉及了许多定理的证明，讲解了包括自然归纳法，结构归纳法在内的多种证明技术。但是在学习的过程中我感觉到传统的证明存在许多不方便之处，例如我很难对自己写的证明进行检查。而这些证明中涉及到的递归结构是计算机非常擅长处理的结构。于是我想：“能否使用计算机来检查我的证明是否正确，换句话说，能不能用计算机语言把证明输入计算机，然后计算机验证证明？”。事实证明这是可行的，并且目前市面上已经有大量的*Theorem Prover/Proof Assistant/Proof Checker*，例如Coq, Isabelle, Lean等，可以对定理证明起到巨大的帮助。于是本文尝试使用Lean来形式化Pump Lemma的证明过程。

## 计算机辅助证明简介

在正式开始之前我们先介绍一下计算机辅助证明。

### 常见误解与澄清

首先澄清一些对计算机辅助证明的误解。

> 计算机辅助证明就是通过浮点数估算或者穷举法来穷举所有情况证明吗？

不是，计算机辅助证明实质上是让计算机来阅读检查人的证明。另外额外说一下，在证明辅助的语言中，一般不会使用浮点数这种工程数学的概念，反之一般会直接定义和数学里一样的有理数，实数等概念，另外请注意我们**并不需要预留无穷多的内存空间**才能**定义**数目有无穷多的自然数，实数等的**概念**，正如同我们用这有限的大脑，不也思考出了这些东西吗。

> 计算机可以根据命题自动给出证明吗？

大部分情况不行，对于一些线性不等式或者平面几何问题似乎有自动证明。**计算机辅助证明不是自动证明，只是帮助验证人写的证明。所以想要使用计算机辅助证明首先使用者一定至少有证明的思路。**

> 计算机验证证明需要现在流行的人工智能吗？

不需要，这两者基本上是完全独立的两个东西。辅助证明基于各种依赖类型论(*dependent type theory*)，完全只是运行普通的程序。人工智能能否对辅助证明起到帮助我目前还不清楚是否有相关研究。

> 计算机验证可靠吗？会出错/bug吗？

可靠，**至少比人可靠**。计算机辅助证明不是靠深度学习一样通过输入大量数据得到经验解然后来判断证明，而是依照严格的类型论逻辑计算得到的结果。辅助证明总是基于一门计算机语言的(比如本文使用的Lean)，我们会了解到这种验证是基于该语言的类型检查器，而类型检查器是程序语言设计的元理论的部分，**应该是不会轻易出现问题的**。这就如同问用计算器算加法或者用C语言可靠吗一样，当然你完全可以担心用来使用他们的前端软件出现bug，不过这就不是本文要谈论的问题了。

> 辅助证明需要写给计算机的证明和我们传统的数学证明差别大吗？这样写证明难度大吗？会更复杂吗？

有一些差别但不大，这就好比用另一种语言去书写证明，虽然书写的规则不同，但是人思考的方式是共通的。并且计算机语言是一种比起自然语言更准确没有二义性的语言，这其实有利有弊：严格的语言意味着人写证明不能再偷懒了，必须要准确的指出说的是什么，有时候会有些繁琐；好处不言自明，计算机可以验证是否正确，并且学习的人也可以通过查代码看每一步是怎么进行的避免跳步而不理解。某种意义上这种形式化的语言更适合数学，也很有趣。

## 问题引入与定义

现在回到本文的主题上来，既然已知计算机是可以辅助我们进行定理证明，我们如何利用这种技术进行泵引理的形式化呢？首先是选定一种Proof Assistant，本文选取的是Lean，因为Lean社区非常注重本科生教育，社区提供了大量的学习资料，目前已经建立了一个非常大规模的数学定理库mathlib。同时还有由*Imperial College London*主导的*Xena Project*在使用*Lean*编写交互式的数学教材，企图引起数学教育革命。可以说对于本科生而言*Lean*是目前最友好的一个Proof Assistant了。

看到问题本身，首先观察Pump Lemma的内容：

> 如果语言$L$是正则语言，那么存在正整数$N$，对$\forall \in L$，如果$|w| \ge N$，那么可以将$w$分为三部分$w=xyz$满足:
> 
> 1. $y\ne \varepsilon$
> 2. $|xy| \le N$
> 3. $\forall k \ge 0, xy^kz\in L$

那么很明显的我们需要在*Lean*中刻画正则语言及其性质。又联想到上课时泵引理是利用了有穷自动机的有限状态数量和鸽巢原理引入的，所以我们可能需要同时刻画某一种有穷自动机，并且描述有穷自动机与正则语言之间的关系来进行证明。目标与流程很明确了：

    1. 定义正则语言并证明一些相关的性质
    2. 定义一种有穷自动机并证明其性质，这里选取了DFA
    3. 定义泵引理，并证明

## 解决问题

### 定义正则语言

```lean
universes v
variables {α β γ : Type*}
/- 一个语言是一个字母表`α`上的串的集合-/
@[derive [has_mem (list α), has_singleton (list α), has_insert (list α), complete_boolean_algebra]]
def language (α) := set (list α)
/- derive some utilities -/
/- derive complete_boolean_algebra则是因为正则语言可以交并补 -/
/- A Boolean algebra is a bounded distributive lattice with a complement operator `c`
 - such that `x ⊓ c(x) = ⊥` and `x ⊔ x = ⊤`. For convenience, it must also provice a set
 - difference operation '\' statisfying `x \ y = x ⊓ c(y)`
 - 布尔代数:https://zh.wikipedia.org/wiki/%E5%B8%83%E5%B0%94%E4%BB%A3%E6%95%B0
 -/
```

如此我们就构造好了一个正则语言的定义，但是仅有这个定义是没什么用的，我们还需要有一些正则语言的性质和运算，这里我将正则语言视作一个semiring并证明了其相关的性质。

```lean
/- 加法, 并 -/
instance : has_add (language α) := ⟨(∪)⟩
/- 乘法, 笛卡尔积 -/
instance : has_mul (language α) := ⟨image2 (++)⟩
/- 加法幺元0，空语言 -/
instance : has_zero (language α) := ⟨(∅ : set _)⟩
/- 乘法幺元1，`1: language α` 接受空串的语言 -/
instance : has_one (language α) := ⟨{[]}⟩
```

关于环同态等更多详细的性质可以查阅[实现代码](https://github.com/JohnsonLee-debug/Computability/blob/a8f6eaa77d6b426de64b376a93c0c6bcee2ae672/src/language.lean#L63)
